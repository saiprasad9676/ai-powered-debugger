{"ast":null,"code":"import React,{createContext,useContext,useEffect,useState}from\"react\";import{auth,signInWithGoogle as firebaseSignInWithGoogle,logOut as firebaseLogOut}from\"../firebase\";import{onAuthStateChanged}from\"firebase/auth\";// Define API URL\nimport{jsx as _jsx}from\"react/jsx-runtime\";const API_URL=process.env.REACT_APP_API_URL||'http://localhost:8000';const AuthContext=/*#__PURE__*/createContext();export const useAuth=()=>useContext(AuthContext);export const AuthProvider=_ref=>{let{children}=_ref;const[currentUser,setCurrentUser]=useState(null);const[userProfile,setUserProfile]=useState(null);const[loading,setLoading]=useState(true);// Create or update user in MongoDB\nconst syncUserWithMongoDB=async user=>{if(!user)return null;try{// Check if user exists in MongoDB\nconst response=await fetch(`${API_URL}/api/users?email=${encodeURIComponent(user.email)}`);if(response.ok){const data=await response.json();if(data.exists){// User exists, update profile if needed\nreturn await fetchUserProfile(user.uid);}else{// Create new user\nconst createResponse=await fetch(`${API_URL}/api/users`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({uid:user.uid,email:user.email,display_name:user.displayName||user.email.split('@')[0],photo_url:user.photoURL||null})});if(createResponse.ok){return await fetchUserProfile(user.uid);}else{console.error('Failed to create user in MongoDB');return null;}}}else{console.error('Failed to check user in MongoDB');return null;}}catch(error){console.error(\"Error syncing user with MongoDB:\",error);return null;}};// Fetch user profile from MongoDB\nconst fetchUserProfile=async userId=>{try{const response=await fetch(`${API_URL}/api/users/${userId}`);if(response.ok){return await response.json();}else{console.error('Failed to fetch user profile');return null;}}catch(error){console.error(\"Error fetching user profile:\",error);return null;}};// Monitor authentication state\nuseEffect(()=>{const unsubscribe=onAuthStateChanged(auth,async user=>{setCurrentUser(user);if(user){try{// Sync user with MongoDB and get profile\nconst profile=await syncUserWithMongoDB(user);setUserProfile(profile);}catch(error){console.error('Error syncing user with MongoDB:',error);}}else{setUserProfile(null);}setLoading(false);});return unsubscribe;},[currentUser,syncUserWithMongoDB]);// Google sign-in handler\nconst signInWithGoogle=async()=>{try{const user=await firebaseSignInWithGoogle();return user;}catch(error){console.error(\"Error in googleSignIn:\",error);throw error;}};// Update user profile in MongoDB\nconst updateUserProfile=async profileData=>{if(!currentUser){throw new Error(\"No authenticated user\");}try{const response=await fetch(`${API_URL}/api/users/${currentUser.uid}/profile`,{method:'PUT',headers:{'Content-Type':'application/json'},body:JSON.stringify(profileData)});if(response.ok){const updatedProfile=await response.json();setUserProfile(updatedProfile);return updatedProfile;}else{throw new Error('Failed to update profile');}}catch(error){console.error(\"Error updating profile:\",error);throw error;}};// Save coding history to MongoDB\nconst saveCodeHistory=async historyData=>{if(!currentUser||!userProfile){console.error(\"Cannot save history: No authenticated user or profile\");return null;}try{const response=await fetch(`${API_URL}/api/users/${currentUser.uid}/history`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({language:historyData.language||'unknown',original_code:historyData.originalCode,fixed_code:historyData.fixedCode,error_message:historyData.errorMessage})});if(response.ok){return await response.json();}else{throw new Error('Failed to save history');}}catch(error){console.error(\"Error saving code history:\",error);return null;}};const value={currentUser,userProfile,loading,signInWithGoogle,logOut:firebaseLogOut,updateUserProfile,saveCodeHistory};return/*#__PURE__*/_jsx(AuthContext.Provider,{value:value,children:!loading&&children});};","map":{"version":3,"names":["React","createContext","useContext","useEffect","useState","auth","signInWithGoogle","firebaseSignInWithGoogle","logOut","firebaseLogOut","onAuthStateChanged","jsx","_jsx","API_URL","process","env","REACT_APP_API_URL","AuthContext","useAuth","AuthProvider","_ref","children","currentUser","setCurrentUser","userProfile","setUserProfile","loading","setLoading","syncUserWithMongoDB","user","response","fetch","encodeURIComponent","email","ok","data","json","exists","fetchUserProfile","uid","createResponse","method","headers","body","JSON","stringify","display_name","displayName","split","photo_url","photoURL","console","error","userId","unsubscribe","profile","updateUserProfile","profileData","Error","updatedProfile","saveCodeHistory","historyData","language","original_code","originalCode","fixed_code","fixedCode","error_message","errorMessage","value","Provider"],"sources":["C:/Users/konda/Videos/Ai-powered-debugger-master/src/context/AuthContext.js"],"sourcesContent":["import React, { createContext, useContext, useEffect, useState } from \"react\";\r\nimport { \r\n  auth, \r\n  signInWithGoogle as firebaseSignInWithGoogle, \r\n  logOut as firebaseLogOut \r\n} from \"../firebase\";\r\nimport { onAuthStateChanged } from \"firebase/auth\";\r\n\r\n// Define API URL\r\nconst API_URL = process.env.REACT_APP_API_URL || 'http://localhost:8000';\r\n\r\nconst AuthContext = createContext();\r\n\r\nexport const useAuth = () => useContext(AuthContext);\r\n\r\nexport const AuthProvider = ({ children }) => {\r\n  const [currentUser, setCurrentUser] = useState(null);\r\n  const [userProfile, setUserProfile] = useState(null);\r\n  const [loading, setLoading] = useState(true);\r\n\r\n  // Create or update user in MongoDB\r\n  const syncUserWithMongoDB = async (user) => {\r\n    if (!user) return null;\r\n    \r\n    try {\r\n      // Check if user exists in MongoDB\r\n      const response = await fetch(`${API_URL}/api/users?email=${encodeURIComponent(user.email)}`);\r\n      \r\n      if (response.ok) {\r\n        const data = await response.json();\r\n        \r\n        if (data.exists) {\r\n          // User exists, update profile if needed\r\n          return await fetchUserProfile(user.uid);\r\n        } else {\r\n          // Create new user\r\n          const createResponse = await fetch(`${API_URL}/api/users`, {\r\n            method: 'POST',\r\n            headers: {\r\n              'Content-Type': 'application/json',\r\n            },\r\n            body: JSON.stringify({\r\n              uid: user.uid,\r\n              email: user.email,\r\n              display_name: user.displayName || user.email.split('@')[0],\r\n              photo_url: user.photoURL || null\r\n            })\r\n          });\r\n          \r\n          if (createResponse.ok) {\r\n            return await fetchUserProfile(user.uid);\r\n          } else {\r\n            console.error('Failed to create user in MongoDB');\r\n            return null;\r\n          }\r\n        }\r\n      } else {\r\n        console.error('Failed to check user in MongoDB');\r\n        return null;\r\n      }\r\n    } catch (error) {\r\n      console.error(\"Error syncing user with MongoDB:\", error);\r\n      return null;\r\n    }\r\n  };\r\n\r\n  // Fetch user profile from MongoDB\r\n  const fetchUserProfile = async (userId) => {\r\n    try {\r\n      const response = await fetch(`${API_URL}/api/users/${userId}`);\r\n      \r\n      if (response.ok) {\r\n        return await response.json();\r\n      } else {\r\n        console.error('Failed to fetch user profile');\r\n        return null;\r\n      }\r\n    } catch (error) {\r\n      console.error(\"Error fetching user profile:\", error);\r\n      return null;\r\n    }\r\n  };\r\n\r\n  // Monitor authentication state\r\n  useEffect(() => {\r\n    const unsubscribe = onAuthStateChanged(auth, async (user) => {\r\n      setCurrentUser(user);\r\n      \r\n      if (user) {\r\n        try {\r\n          // Sync user with MongoDB and get profile\r\n          const profile = await syncUserWithMongoDB(user);\r\n          setUserProfile(profile);\r\n        } catch (error) {\r\n          console.error('Error syncing user with MongoDB:', error);\r\n        }\r\n      } else {\r\n        setUserProfile(null);\r\n      }\r\n      \r\n      setLoading(false);\r\n    });\r\n\r\n    return unsubscribe;\r\n  }, [currentUser, syncUserWithMongoDB]);\r\n\r\n  // Google sign-in handler\r\n  const signInWithGoogle = async () => {\r\n    try {\r\n      const user = await firebaseSignInWithGoogle();\r\n      return user;\r\n    } catch (error) {\r\n      console.error(\"Error in googleSignIn:\", error);\r\n      throw error;\r\n    }\r\n  };\r\n\r\n  // Update user profile in MongoDB\r\n  const updateUserProfile = async (profileData) => {\r\n    if (!currentUser) {\r\n      throw new Error(\"No authenticated user\");\r\n    }\r\n    \r\n    try {\r\n      const response = await fetch(`${API_URL}/api/users/${currentUser.uid}/profile`, {\r\n        method: 'PUT',\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n        },\r\n        body: JSON.stringify(profileData)\r\n      });\r\n      \r\n      if (response.ok) {\r\n        const updatedProfile = await response.json();\r\n        setUserProfile(updatedProfile);\r\n        return updatedProfile;\r\n      } else {\r\n        throw new Error('Failed to update profile');\r\n      }\r\n    } catch (error) {\r\n      console.error(\"Error updating profile:\", error);\r\n      throw error;\r\n    }\r\n  };\r\n\r\n  // Save coding history to MongoDB\r\n  const saveCodeHistory = async (historyData) => {\r\n    if (!currentUser || !userProfile) {\r\n      console.error(\"Cannot save history: No authenticated user or profile\");\r\n      return null;\r\n    }\r\n    \r\n    try {\r\n      const response = await fetch(`${API_URL}/api/users/${currentUser.uid}/history`, {\r\n        method: 'POST',\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n        },\r\n        body: JSON.stringify({\r\n          language: historyData.language || 'unknown',\r\n          original_code: historyData.originalCode,\r\n          fixed_code: historyData.fixedCode,\r\n          error_message: historyData.errorMessage\r\n        })\r\n      });\r\n      \r\n      if (response.ok) {\r\n        return await response.json();\r\n      } else {\r\n        throw new Error('Failed to save history');\r\n      }\r\n    } catch (error) {\r\n      console.error(\"Error saving code history:\", error);\r\n      return null;\r\n    }\r\n  };\r\n\r\n  const value = {\r\n    currentUser,\r\n    userProfile,\r\n    loading,\r\n    signInWithGoogle,\r\n    logOut: firebaseLogOut,\r\n    updateUserProfile,\r\n    saveCodeHistory\r\n  };\r\n\r\n  return (\r\n    <AuthContext.Provider value={value}>\r\n      {!loading && children}\r\n    </AuthContext.Provider>\r\n  );\r\n}; "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}